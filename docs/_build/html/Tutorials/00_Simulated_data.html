<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Example of Caenorhabditis elegans Dataset" href="01_Experimental_data.html" /><link rel="prev" title="Tutorials" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Example of Simulated Data - LineageGRN 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #357473;
  --color-brand-content: #357473;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">LineageGRN 0.0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Example of Simulated Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Experimental_data.html">Example of Caenorhabditis elegans Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Experimental_data.html">Example of Zebrafish Heart Regeneration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API/index.html">API</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/Tutorials/00_Simulated_data.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="example-of-simulated-data">
<h1>Example of Simulated Data<a class="headerlink" href="#example-of-simulated-data" title="Link to this heading">¶</a></h1>
<p>In this tutorial, we demonstrate the basic usage of <strong>LineageGRN</strong> using simulated data. This example highlights how LineageGRN combines scATAC-seq and scRNA-seq data with cell lineage information to infer dynamic gene regulatory networks.</p>
<!-- Workflow Visualization -->
<div style="text-align: center;">
  <img src="../_static/simulation_workflow.png" alt="Simulation Workflow" style="width: 300%;">
</div>
<hr class="docutils" />
<section id="data-generation">
<h2>Data Generation<a class="headerlink" href="#data-generation" title="Link to this heading">¶</a></h2>
<section id="time-scaled-cell-fate-map">
<h3>1. Time-scaled Cell Fate Map<a class="headerlink" href="#time-scaled-cell-fate-map" title="Link to this heading">¶</a></h3>
<p>In this example, we use the topology structure of a time-scaled fate map (represented by <code class="docutils literal notranslate"><span class="pre">fate_map_edge_dict</span></code> with 7 nodes/cell clusters) as input. We also set a state transition rate (<code class="docutils literal notranslate"><span class="pre">lambda</span></code>) to measure the probability that a child GRN inherits the known regulatory relationships of its parent GRN.</p>
<section id="load-and-process-fate-map">
<h4>Load and Process Fate Map<a class="headerlink" href="#load-and-process-fate-map" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the fate map topology from CSV and process it into a FateMap object.</span>
<span class="n">fate_map_path</span> <span class="o">=</span> <span class="s1">&#39;examples/data/simulation/input/edge_dict_simulation.csv&#39;</span>
<span class="n">edge_dict</span> <span class="o">=</span> <span class="n">load_fate_map_topology</span><span class="p">(</span><span class="n">fate_map_path</span><span class="p">)</span>
<span class="n">edge</span> <span class="o">=</span> <span class="n">parse_edge_dict</span><span class="p">(</span><span class="n">edge_dict</span><span class="p">)</span>
<span class="n">fate_map_topology</span> <span class="o">=</span> <span class="n">FateMap</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
<span class="n">newick_format</span> <span class="o">=</span> <span class="n">generate_newick</span><span class="p">(</span><span class="n">fate_map_topology</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample Newick Format Output:</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>&#39;((T3:0.6,T4:0.6)P1:0.4,(T5:0.9,T6:0.9)P2:0.1)P0:0;&#39;
</pre></div>
</div>
</section>
<section id="fate-map-visualization-rscript">
<h4>Fate Map Visualization (Rscript)<a class="headerlink" href="#fate-map-visualization-rscript" title="Link to this heading">¶</a></h4>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use R to generate a fate map plot.</span>
<span class="n">Rscript</span><span class="w"> </span><span class="n">plot_fate_map.R</span><span class="w"> </span><span class="s">&quot;((T3:0.6,T4:0.6)P1:0.4,(T5:0.9,T6:0.9)P2:0.1)P0:0;&quot;</span><span class="w"> </span><span class="m">1.2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0.3</span><span class="w"> </span><span class="n">fate_map_plot.pdf</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="ground-truth-grns">
<h3>2. Ground Truth GRNs<a class="headerlink" href="#ground-truth-grns" title="Link to this heading">¶</a></h3>
<section id="generate-the-root-grn">
<h4>Generate the Root GRN<a class="headerlink" href="#generate-the-root-grn" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>Parameters</strong>: 150 target genes, 100 regulators</p></li>
<li><p><strong>Output</strong>: A pandas DataFrame <code class="docutils literal notranslate"><span class="pre">grn0</span></code> where:</p>
<ul>
<li><p><strong>Rows</strong>: represent regulators</p></li>
<li><p><strong>Columns</strong>: represent target genes</p></li>
<li><p><strong>Elements</strong>: range from -1 to 1, with the absolute value indicating regulatory strength, and the sign indicating activation (+) or repression (-)</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define output path for the ground truth GRN.</span>
<span class="n">grns_path</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/additional_output/ground_truth_grn&#39;</span>

<span class="c1"># Generate the root GRN.</span>
<span class="n">grn0</span> <span class="o">=</span> <span class="n">generate_root_grn</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">grns_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample DataFrame Output:</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>      0        1         2         3   ...   148       149
150  -0.7318   0.5520    0.0000    0.0000 ...   0.2533    0.0000
151   0.0000   0.3824    0.4575    0.4303 ...  -0.8496    0.0000
...
</pre></div>
</div>
</section>
<section id="generate-descendant-grns">
<h4>Generate Descendant GRNs<a class="headerlink" href="#generate-descendant-grns" title="Link to this heading">¶</a></h4>
<p>Load the dynamic GRN topology and generate descendant GRNs for each cell cluster based on the fate map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load additional GRN topology and generate descendant GRNs.</span>
<span class="n">grn_dict_path</span> <span class="o">=</span> <span class="s1">&#39;examples/data/simulation/additional_input_data/grn_dict.csv&#39;</span>
<span class="n">grn_dict</span> <span class="o">=</span> <span class="n">load_fate_map_topology</span><span class="p">(</span><span class="n">grn_dict_path</span><span class="p">)</span>
<span class="n">decendent_grns</span> <span class="o">=</span> <span class="n">generate_descendant_grns</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">grn_dict</span><span class="p">,</span> <span class="n">grns_path</span><span class="p">,</span> <span class="n">grn0</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="scrna-seq-data">
<h3>3. scRNA-seq Data<a class="headerlink" href="#scrna-seq-data" title="Link to this heading">¶</a></h3>
<p>Generate expression data required by SERGIO. For each node, the output DataFrame has:</p>
<ul class="simple">
<li><p><strong>Rows</strong>: regulators and target genes</p></li>
<li><p><strong>Columns</strong>: sampled cells</p></li>
<li><p><strong>Elements</strong>: gene expression values</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate scRNA-seq expression data.</span>
<span class="n">sergio_files_path</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/additional_output/sergio_files&#39;</span>
<span class="n">expr_matrix_path</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/additional_output/expression_files&#39;</span>
<span class="n">generate_expression_data</span><span class="p">(</span><span class="n">decendent_grns</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">sergio_files_path</span><span class="p">,</span> <span class="n">expr_matrix_path</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Console Output (Sample):</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>Start simulating new level
There are 100 genes to simulate in this layer
Done with current level
...
Start simulating new level
There are 150 genes to simulate in this layer
Done with current level
</pre></div>
</div>
<p>Convert the generated expression data into the LineageGRN input format. The final DataFrame includes five columns:<br />
<code class="docutils literal notranslate"><span class="pre">gene_id</span></code>, <code class="docutils literal notranslate"><span class="pre">cell_id</span></code>, <code class="docutils literal notranslate"><span class="pre">gene</span> <span class="pre">expression_value</span></code>, <code class="docutils literal notranslate"><span class="pre">node_id</span></code>, <code class="docutils literal notranslate"><span class="pre">gene_type</span></code> (target_gene or regulator_gene)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert expression files to LineageGRN input format.</span>
<span class="n">expression_file_path</span> <span class="o">=</span> <span class="s1">&#39;examples/data/simulation/input/expression_data.csv&#39;</span>

<span class="c1"># Load gene names.</span>
<span class="n">target_genes_name</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/data/simulation/additional_input_data/target_genes_name.csv&#39;</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">regulatory_genes_name</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/data/simulation/additional_input_data/regulatory_genes_name.csv&#39;</span><span class="p">)[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">convert_expression_file</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">target_genes_name</span><span class="p">,</span> <span class="n">regulatory_genes_name</span><span class="p">,</span> <span class="n">expr_matrix_path</span><span class="p">,</span> <span class="n">expression_file_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample Converted Data (First Few Rows):</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>gene         cell      value   node_id    gene_type
target_0     cell_0    10.0    grn3       target_gene
target_0     cell_1    18.0    grn3       target_gene
target_0     cell_2    15.0    grn3       target_gene
...
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="scatac-seq-data">
<h3>4. scATAC-seq Data<a class="headerlink" href="#scatac-seq-data" title="Link to this heading">¶</a></h3>
<p>Generate scATAC-seq data as a pandas DataFrame with the following columns:<br />
<code class="docutils literal notranslate"><span class="pre">target_gene_id</span></code>, <code class="docutils literal notranslate"><span class="pre">regulator_id</span></code>, <code class="docutils literal notranslate"><span class="pre">co-accessibility</span> <span class="pre">score</span></code>, <code class="docutils literal notranslate"><span class="pre">node_id</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate scATAC-seq data.</span>
<span class="n">atac_file_path</span> <span class="o">=</span> <span class="s1">&#39;examples/data/simulation/input/atac_data.csv&#39;</span>
<span class="n">atac_data</span> <span class="o">=</span> <span class="n">generate_atac_data</span><span class="p">(</span><span class="n">decendent_grns</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">atac_file_path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="inference-of-gene-regulatory-networks">
<h2>Inference of Gene Regulatory Networks<a class="headerlink" href="#inference-of-gene-regulatory-networks" title="Link to this heading">¶</a></h2>
<p>Use the generated scATAC-seq and scRNA-seq data to infer GRNs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup GRN inference.</span>
<span class="n">saved_dir</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/inferred_grns/inferred_grn_defult_params&#39;</span>
<span class="n">fate_map</span> <span class="o">=</span> <span class="n">FateMap</span><span class="p">(</span><span class="n">parse_edge_dict</span><span class="p">(</span><span class="n">grn_dict</span><span class="p">))</span>

<span class="c1"># Run GRN inference.</span>
<span class="n">grn_inference_result</span> <span class="o">=</span> <span class="n">GRNInference</span><span class="p">(</span><span class="n">atac_file_path</span><span class="p">,</span> <span class="n">expression_file_path</span><span class="p">,</span> <span class="n">fate_map</span><span class="p">,</span> <span class="n">saved_dir</span><span class="p">)</span>
<span class="n">grn_inference_result</span><span class="o">.</span><span class="n">infer_grn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample Log Output:</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>-2024-09-24 11:32:58,551-INFO-52272 Start fitting target_gene_id:1
-2024-09-24 11:34:56,762-INFO-25168 Finish inferencing leaves grn value for target_gene_id:1
-2024-09-24 11:34:56,763-INFO-25168 Saved grn values for target_gene_id:1
...
</pre></div>
</div>
<p>Retrieve target gene networks by setting a threshold (e.g., 0.1) to filter effective regulatory relationships.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get target networks with a threshold of 0.1.</span>
<span class="n">target_networks_dict</span> <span class="o">=</span> <span class="n">grn_inference</span><span class="o">.</span><span class="n">get_target_networks</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>For an alternative output format, generate a dictionary where:</p>
<ul class="simple">
<li><p><strong>Key</strong>: <code class="docutils literal notranslate"><span class="pre">node_id</span></code></p></li>
<li><p><strong>Value</strong>: A DataFrame with rows for target genes and columns for regulators</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate dynamic networks for each fate map node.</span>
<span class="n">dynamic_networks_dict</span> <span class="o">=</span> <span class="n">get_dynamic_networks</span><span class="p">(</span><span class="n">saved_dir</span><span class="p">,</span> <span class="n">grns</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">regulatory_genes_name</span><span class="p">,</span> <span class="n">target_genes_name</span><span class="p">)</span>
</pre></div>
</div>
<section id="visualizing-the-fate-map-path">
<h3>Visualizing the Fate Map Path<a class="headerlink" href="#visualizing-the-fate-map-path" title="Link to this heading">¶</a></h3>
<p>You can visualize the inferred GRN along a specific path using the <code class="docutils literal notranslate"><span class="pre">.get_path</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Get the path for node &#39;grn5&#39;.</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">fate_map</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;grn5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># Expected output: [&#39;grn0&#39;, &#39;grn2&#39;, &#39;grn5&#39;]</span>
</pre></div>
</div>
<p>Extract and format the GRN along the selected path into a three-column DataFrame using <code class="docutils literal notranslate"><span class="pre">get_gene_interaction</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract networks for grn0, grn2, and grn5.</span>
<span class="n">network0</span> <span class="o">=</span> <span class="n">dynamic_networks_dict</span><span class="p">[</span><span class="s1">&#39;grn0&#39;</span><span class="p">]</span>
<span class="n">network2</span> <span class="o">=</span> <span class="n">dynamic_networks_dict</span><span class="p">[</span><span class="s1">&#39;grn2&#39;</span><span class="p">]</span>
<span class="n">network5</span> <span class="o">=</span> <span class="n">dynamic_networks_dict</span><span class="p">[</span><span class="s1">&#39;grn5&#39;</span><span class="p">]</span>

<span class="c1"># Assign gene names to columns and index.</span>
<span class="n">network0</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">network2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">network5</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">regulatory_genes_name</span>
<span class="n">network0</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">network2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">network5</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">target_genes_name</span>

<span class="c1"># Get gene interactions.</span>
<span class="n">gene0_interaction</span> <span class="o">=</span> <span class="n">get_gene_interaction</span><span class="p">(</span><span class="n">network0</span><span class="p">)</span>
<span class="n">gene2_interaction</span> <span class="o">=</span> <span class="n">get_gene_interaction</span><span class="p">(</span><span class="n">network2</span><span class="p">)</span>
<span class="n">gene5_interaction</span> <span class="o">=</span> <span class="n">get_gene_interaction</span><span class="p">(</span><span class="n">network5</span><span class="p">)</span>

<span class="c1"># Save interaction results.</span>
<span class="n">gene0_interaction</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/inferred_grns/interaction_format/gene0_interaction.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">gene2_interaction</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/inferred_grns/interaction_format/gene2_interaction.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">gene5_interaction</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/inferred_grns/interaction_format/gene5_interaction.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Visualize GRNs on the selected pathways using R scripts:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot GRN for grn0.</span>
<span class="n">Rscript</span><span class="w"> </span><span class="n">plot_grn.R</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_output</span><span class="o">/</span><span class="n">expression_files</span><span class="o">/</span><span class="n">Exp_grn5.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">target_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">regulatory_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">inferred_grns</span><span class="o">/</span><span class="n">interaction_format</span><span class="o">/</span><span class="n">gene0_interaction.csv</span><span class="w"> </span><span class="n">grn0_plot.pdf</span>

<span class="c1"># Plot GRN for grn2.</span>
<span class="n">Rscript</span><span class="w"> </span><span class="n">plot_grn.R</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_output</span><span class="o">/</span><span class="n">expression_files</span><span class="o">/</span><span class="n">Exp_grn5.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">target_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">regulatory_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">inferred_grns</span><span class="o">/</span><span class="n">interaction_format</span><span class="o">/</span><span class="n">gene2_interaction.csv</span><span class="w"> </span><span class="n">grn2_plot.pdf</span>

<span class="c1"># Plot GRN for grn5.</span>
<span class="n">Rscript</span><span class="w"> </span><span class="n">plot_grn.R</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_output</span><span class="o">/</span><span class="n">expression_files</span><span class="o">/</span><span class="n">Exp_grn5.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">target_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">additional_input_data</span><span class="o">/</span><span class="n">regulatory_genes_name.csv</span><span class="w"> </span>\
<span class="n">examples</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">simulation</span><span class="o">/</span><span class="n">inferred_grns</span><span class="o">/</span><span class="n">interaction_format</span><span class="o">/</span><span class="n">gene5_interaction.csv</span><span class="w"> </span><span class="n">grn5_plot.pdf</span>
</pre></div>
</div>
<div style="text-align: center;">
  <img src="../_static/grns.png" alt="GRNs Visualization" style="width: 80%;">
</div>
</section>
</section>
<hr class="docutils" />
<section id="validation-of-lineagegrn-performance">
<h2>Validation of LineageGRN Performance<a class="headerlink" href="#validation-of-lineagegrn-performance" title="Link to this heading">¶</a></h2>
<p>Traverse all fate map nodes to compute AUROC and AUPRC by comparing inferred GRNs with the ground truth.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate performance for each fate map node.</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fate_map</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">auroc_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">auprc_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
    <span class="n">grn_infer</span> <span class="o">=</span> <span class="n">dynamic_networks_dict</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
    <span class="n">grn_true</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/additional_output/ground_truth_grn/&#39;</span><span class="o">+</span><span class="n">node_id</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="n">grn_true</span> <span class="o">=</span> <span class="n">grn_true</span><span class="o">.</span><span class="n">T</span>
    <span class="n">auroc</span> <span class="o">=</span> <span class="n">compute_auroc</span><span class="p">(</span><span class="n">grn_infer</span><span class="p">,</span> <span class="n">grn_true</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">auprc</span> <span class="o">=</span> <span class="n">compute_auprc</span><span class="p">(</span><span class="n">grn_infer</span><span class="p">,</span> <span class="n">grn_true</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">([</span><span class="n">node_id</span><span class="p">,</span> <span class="n">auroc</span><span class="p">,</span> <span class="n">auprc</span><span class="p">])</span>
    <span class="n">auroc_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">node_id</span><span class="p">,</span> <span class="n">auroc</span><span class="p">])</span>
    <span class="n">auprc_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">node_id</span><span class="p">,</span> <span class="n">auprc</span><span class="p">])</span>
    
<span class="n">auroc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auroc_list</span><span class="p">)</span>
<span class="n">auroc_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">auprc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">auprc_list</span><span class="p">)</span>
<span class="n">auprc_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">auprc_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/evaluation_result/auprc.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">auroc_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;examples/results/simulation/evaluation_result/auroc.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample Output:</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>[&#39;grn0&#39;, 0.6080135899404416, 0.6076961007516475]
[&#39;grn1&#39;, 0.6778555297246805, 0.6693773066892854]
[&#39;grn2&#39;, 0.6118844499627417, 0.5970852889617932]
[&#39;grn3&#39;, 0.820360973156812, 0.8165970672496445]
[&#39;grn4&#39;, 0.8171958121109225, 0.8123780232426353]
[&#39;grn5&#39;, 0.8240320911215709, 0.8254550385925934]
[&#39;grn6&#39;, 0.8197851536821597, 0.8222811570776326]
</pre></div>
</div>
</section>
<section id="lineagegrn-performance-verification-under-perturbed-fate-map">
<h2>LineageGRN performance verification under perturbed fate map<a class="headerlink" href="#lineagegrn-performance-verification-under-perturbed-fate-map" title="Link to this heading">¶</a></h2>
<p>Infer GRNs based on the perturbed fate map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## Perturb the length of the fate map, the strengths are 0.05, 0.1, 0.3, 0.5, 0.7 respectively</span>
<span class="n">saved_dir_pert005</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/inferred_grns/inferred_grn_pert005&#39;</span>
<span class="n">fate_map_pert005</span> <span class="o">=</span> <span class="n">perturb_branch_lengths</span><span class="p">(</span><span class="n">newick_format</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>

<span class="n">grn_inference_result_pert005</span> <span class="o">=</span> <span class="n">GRNInference</span><span class="p">(</span><span class="n">atac_file_path</span><span class="p">,</span> <span class="n">expression_file_path</span><span class="p">,</span> <span class="n">fate_map_pert005</span><span class="p">,</span> <span class="n">saved_dir_pert005</span><span class="p">)</span>
<span class="n">grn_inference_result_pert005</span><span class="o">.</span><span class="n">infer_grn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">grn_dict_pert005</span> <span class="o">=</span> <span class="n">get_dynamic_networks</span><span class="p">(</span><span class="n">saved_dir_pert005</span><span class="p">,</span> <span class="n">fate_map_pert005</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">regulatory_genes_name</span><span class="p">,</span> <span class="n">target_genes_name</span><span class="p">)</span>

<span class="c1">#...</span>

<span class="c1">## Perturb the topology of the fate map, but keep the triplets unchanged</span>
<span class="n">newick_format_pert_topology</span> <span class="o">=</span> <span class="s1">&#39;(((grn3:0.6,grn4:0.6)grn1:0.4,grn5:0.9)grn2:0.1,grn6:1.0)grn0:0;&#39;</span>
<span class="n">saved_dir_pert_topology</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/inferred_grns/inferred_grn_pert_topology&#39;</span>

<span class="n">edge_dict_pert_topology</span> <span class="o">=</span> <span class="n">newick_to_edge_length_dict</span><span class="p">(</span><span class="n">newick_format_pert_topology</span><span class="p">)</span>
<span class="n">edge_pert_topology</span> <span class="o">=</span> <span class="n">parse_edge_dict</span><span class="p">(</span><span class="n">edge_dict_pert_topology</span><span class="p">)</span>
<span class="n">fate_map_pert_topology</span> <span class="o">=</span> <span class="n">FateMap</span><span class="p">(</span><span class="n">edge_pert_topology</span><span class="p">)</span>

<span class="n">grn_inference_result_pert_str</span> <span class="o">=</span> <span class="n">GRNInference</span><span class="p">(</span><span class="n">atac_file_path</span><span class="p">,</span> <span class="n">expression_file_path</span><span class="p">,</span> <span class="n">fate_map_pert_topology</span><span class="p">,</span> <span class="n">saved_dir_pert_topology</span><span class="p">)</span>
<span class="n">grn_inference_result_pert_str</span><span class="o">.</span><span class="n">infer_grn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">grn_dict_pert_topology</span> <span class="o">=</span> <span class="n">get_dynamic_networks</span><span class="p">(</span><span class="n">saved_dir_pert_topology</span><span class="p">,</span> <span class="n">fate_map_pert_topology</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">regulatory_genes_name</span><span class="p">,</span> <span class="n">target_genes_name</span><span class="p">)</span>
</pre></div>
</div>
<p>The <strong>Jaccard index</strong> and <strong>key regulators overlap</strong> are used to compare the differences in GRN inference based on fate maps before and after perturbation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">jaccard_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">overlap_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">grn_pert</span> <span class="o">=</span> <span class="p">[</span><span class="n">grn_dict_pert005</span><span class="p">,</span> <span class="n">grn_dict_pert01</span><span class="p">,</span> <span class="n">grn_dict_pert03</span><span class="p">,</span> <span class="n">grn_dict_pert05</span><span class="p">,</span> <span class="n">grn_dict_pert07</span><span class="p">,</span> <span class="n">grn_dict_pert_topology</span><span class="p">]</span>
<span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grn_pert</span><span class="p">)):</span>
    <span class="n">jaccard_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_perturbation_impact</span><span class="p">(</span><span class="n">grn_pert</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">dynamic_networks_dict</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">overlap_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_perturbation_impact</span><span class="p">(</span><span class="n">grn_pert</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">dynamic_networks_dict</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jaccard_means</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">overlap_means</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample Output:</strong></p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>[0.9928021771748436, 0.9306423926821185, 0.9301414871605946, 0.9299776335481349, 0.9281831137652954, 0.8616158941999136]
[0.9714285714285714, 0.880952380952381, 0.880952380952381, 0.8857142857142858, 0.8857142857142858, 0.8238095238095238]
</pre></div>
</div>
<p><strong>Visualization:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="n">perturbation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0.05&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;0.3&quot;</span><span class="p">,</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span><span class="p">,</span> <span class="s2">&quot;Topology&quot;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#EFEFEF&#39;</span><span class="p">,</span> <span class="s1">&#39;#DCDDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;#C9CACA&#39;</span><span class="p">,</span> <span class="s1">&#39;#B5B5B6&#39;</span><span class="p">,</span> <span class="s1">&#39;#9FA0A0&#39;</span><span class="p">,</span> <span class="s1">&#39;#A3CA89&#39;</span><span class="p">]</span>
<span class="n">metric_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Jaccard index&quot;</span><span class="p">,</span> <span class="s2">&quot;Key regulator overlap&quot;</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metric_labels</span><span class="p">))</span> 
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">jac</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">jaccard_means</span><span class="p">,</span> <span class="n">overlap_means</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">perturbation_labels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bar_width</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bar_width</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">over</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">metric_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;GRN similarity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set_fontname</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>

<span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">perturbation_labels</span><span class="p">)]</span>
<span class="n">legend_font</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="o">=</span><span class="n">legend_handles</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
    <span class="n">prop</span><span class="o">=</span><span class="n">legend_font</span><span class="p">,</span>
    <span class="n">markerscale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">handleheight</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">borderpad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.4</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;#666666&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#666666&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#666666&#39;</span><span class="p">)</span>

<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;examples/results/simulation/additional_output/figures&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;pert_grouped.eps&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div style="text-align: center;">
  <img src="../_static/pert_result.svg" alt="Perturbation Result Visualization" style="width: 50%;">
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="01_Experimental_data.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Example of Caenorhabditis elegans Dataset</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorials</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Xiaochen Yu
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Example of Simulated Data</a><ul>
<li><a class="reference internal" href="#data-generation">Data Generation</a><ul>
<li><a class="reference internal" href="#time-scaled-cell-fate-map">1. Time-scaled Cell Fate Map</a><ul>
<li><a class="reference internal" href="#load-and-process-fate-map">Load and Process Fate Map</a></li>
<li><a class="reference internal" href="#fate-map-visualization-rscript">Fate Map Visualization (Rscript)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ground-truth-grns">2. Ground Truth GRNs</a><ul>
<li><a class="reference internal" href="#generate-the-root-grn">Generate the Root GRN</a></li>
<li><a class="reference internal" href="#generate-descendant-grns">Generate Descendant GRNs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scrna-seq-data">3. scRNA-seq Data</a></li>
<li><a class="reference internal" href="#scatac-seq-data">4. scATAC-seq Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inference-of-gene-regulatory-networks">Inference of Gene Regulatory Networks</a><ul>
<li><a class="reference internal" href="#visualizing-the-fate-map-path">Visualizing the Fate Map Path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation-of-lineagegrn-performance">Validation of LineageGRN Performance</a></li>
<li><a class="reference internal" href="#lineagegrn-performance-verification-under-perturbed-fate-map">LineageGRN performance verification under perturbed fate map</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>